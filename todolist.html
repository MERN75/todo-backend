<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Responsive ToDo App</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  body {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    background: #ffffff; /* page outside app is white */
  }

  .app {
    width: 90%;
    max-width: 400px;
    min-height: 600px;
    background: #111827; /* dark background inside app container */
    border-radius: 24px;
    padding: 20px;
    color: #fbbf24; /* yellow text for highlights */
    position: relative;
    display: flex;
    flex-direction: column;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    font-family: 'Great Vibes', cursive; /* make all titles use welcome font */
  }

  h1, h2 {
    text-align: center;
    margin-bottom: 15px;
    font-family: 'Great Vibes', cursive;
    font-weight: normal;
  }

  h1 span {
    color: #f59e0b; /* highlight in yellow */
  }

  p.subtitle {
    text-align:center;
    opacity:0.7;
    margin-bottom:20px;
    font-size: 1rem;
    color: #fbbf24;
    animation: fadeIn 2s ease forwards;
    animation-delay: 0.5s;
  }

  .hidden { display:none; }
  .back {
    background:none; border:none; color:#fbbf24; margin-bottom:10px; cursor:pointer; font-size:1rem;
  }

  button.primary {
    background:#fbbf24; /* yellow button */
    color:#111827;
    border:none;
    padding:12px; border-radius:14px; width:100%; cursor:pointer;
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: 'Great Vibes', cursive;
  }
  button.primary:hover { background: #f59e0b; transform: translateY(-2px); }

  button.icon-btn {
    background:#1f2937; border:none; color:#fbbf24;
    padding:8px 14px; border-radius:10px; cursor:pointer;
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: 'Great Vibes', cursive;
  }
  button.icon-btn:hover { background:#374151; transform: translateY(-2px); }

  input, textarea {
    width:100%; padding:12px; border-radius:14px; border:1px solid #374151; margin-bottom:12px;
    font-size: 1rem;
    background:#1f2937;
    color:#fbbf24;
    font-family: 'Great Vibes', cursive;
  }

  ul { list-style:none; padding:0; max-height:300px; overflow-y:auto; }
  li {
    background:#1f2937; padding:12px; border-radius:14px; margin-bottom:10px; cursor:pointer;
    word-wrap: break-word;
    color:#fbbf24;
    font-family: 'Great Vibes', cursive;
  }

  .top-icons {
    display:flex; flex-wrap:wrap; justify-content:flex-end; gap:10px; margin-bottom:12px;
  }

  .checkbox {
    display:flex; flex-wrap:wrap; align-items:flex-start; gap:12px;
    margin-bottom:14px; padding:10px; background:#1f2937; border-radius:12px;
    color:#fbbf24;
    font-family: 'Great Vibes', cursive;
  }
  .checkbox input { margin-top:4px; }

  .confirm{
    position: fixed;
    inset:0;
    background:rgba(0,0,0,.5);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:1000;
    visibility:hidden;
    opacity:0;
    transition: opacity 0.2s;
  }
  .confirm.show{
    visibility: visible;
    opacity: 1;
  }
  .confirm-box{
    background:#111827;
    padding:20px;
    border-radius:16px;
    width:90%;
    max-width:300px;
    text-align:center;
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
    color:#fbbf24;
    font-family: 'Great Vibes', cursive;
  }
  .confirm-box button{
    margin-top:10px;
    width: 48%;
    margin-right: 2%;
  }
  .confirm-box button:last-child { margin-right:0; }

  @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:0.7; transform: translateY(0);} }
  @keyframes slideDown { from {opacity:0; transform: translateY(-20px);} to {opacity:1; transform: translateY(0);} }

  @media (max-width: 360px){
    .app { padding: 15px; border-radius: 16px; }
    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }
    button.primary, button.icon-btn { font-size: 0.9rem; padding: 10px; }
    input, textarea { font-size: 0.9rem; padding:10px; }
  }
</style>
</head>
<body>
<div class="app">

<!-- HOME -->
<div id="home">
  <h1>Welcome to <span>ToDo App</span></h1>
  <p class="subtitle">Organize your day, one task at a time</p>
  <div style="display:flex;flex-direction:column;gap:15px;margin-top:40px">
    <button class="primary" onclick="showAdd()">Add New Task</button>
    <button class="primary" onclick="showList()">View Tasks</button>
  </div>
</div>

<!-- ADD TASK -->
<div id="addTask" class="hidden">
  <button class="back" onclick="showList()">‚Üê Back</button>
  <h2>Add Task</h2>
  <input id="taskTitle" placeholder="Task title">
  <textarea id="taskDesc" placeholder="Task details"></textarea>
  <button class="primary" onclick="saveTask()">Save</button>
</div>

<!-- TASK LIST -->
<div id="taskList" class="hidden">
  <button class="back" onclick="goHome()">‚Üê Back</button>
  <h2>Tasks</h2>
  <div class="top-icons">
    <button class="icon-btn" onclick="showAdd()">Ôºã</button>
    <button class="icon-btn" onclick="showDeleteScreen()">üóë</button>
  </div>
  <ul id="tasks"></ul>
</div>

<!-- TASK DETAIL -->
<div id="taskDetail" class="hidden">
  <button class="back" onclick="showList()">‚Üê Back</button>
  <input id="detailTitle" />
  <textarea id="detailDesc"></textarea>
  <button class="icon-btn" onclick="saveEdit()">Save Changes</button>
  <button class="icon-btn" onclick="askDelete()">Delete</button>
</div>

<!-- DELETE SCREEN -->
<div id="deleteScreen" class="hidden">
  <button class="back" onclick="showList()">‚Üê Back</button>
  <h2>Select tasks to delete</h2>
  <div id="deleteList"></div>
  <button class="primary" onclick="confirmDelete()">Delete Selected</button>
</div>

<!-- CONFIRM DELETE -->
<div id="confirmBox" class="confirm">
  <div class="confirm-box">
    <p>Are you sure you want to delete this task?</p>
    <button class="primary" onclick="deleteCurrentTask()">Yes</button>
    <button class="icon-btn" onclick="closeConfirm()">No</button>
  </div>
</div>

</div>
<script>
const API_URL = 'http://localhost:5000/api/tasks';

let currentIndex = null;

const home = document.getElementById('home');
const addTask = document.getElementById('addTask');
const taskList = document.getElementById('taskList');
const taskDetail = document.getElementById('taskDetail');
const deleteScreen = document.getElementById('deleteScreen');
const confirmBox = document.getElementById('confirmBox');

function hideAll() {
  [home, addTask, taskList, taskDetail, deleteScreen].forEach(v => v.classList.add('hidden'));
}
function goHome() {
  hideAll();
  home.classList.remove('hidden');
}
function showAdd() {
  hideAll();
  addTask.classList.remove('hidden');
}
function showList() {
  hideAll();
  taskList.classList.remove('hidden');
  renderTasks();
}

async function fetchTasks() {
  const res = await fetch(API_URL);
  if (!res.ok) throw new Error('Failed to fetch tasks');
  return await res.json();
}

async function saveTask() {
  const title = document.getElementById('taskTitle').value.trim();
  const desc = document.getElementById('taskDesc').value;
  if (!title) return alert('Enter title');

  const res = await fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, description: desc })
  });

  if (res.ok) {
    document.getElementById('taskTitle').value = '';
    document.getElementById('taskDesc').value = '';
    showList();
  } else {
    alert('Failed to save task');
  }
}

async function renderTasks() {
  try {
    const tasks = await fetchTasks();
    const tasksEl = document.getElementById('tasks');
    if (tasks.length === 0) {
      tasksEl.innerHTML = '<li>No tasks</li>';
      return;
    }
    tasksEl.innerHTML = tasks.map((t, i) =>
      `<li onclick="openDetail(${t.id})"><strong>${t.title}</strong><br><small>${t.description || ''}</small></li>`
    ).join('');
  } catch (e) {
    alert('Error loading tasks');
  }
}

async function openDetail(id) {
  currentIndex = id;
  try {
    const res = await fetch(`${API_URL}/${id}`);
    if (!res.ok) throw new Error();
    const task = await res.json();
    document.getElementById('detailTitle').value = task.title;
    document.getElementById('detailDesc').value = task.description || '';
    hideAll();
    taskDetail.classList.remove('hidden');
  } catch {
    alert('Failed to load task details');
  }
}

async function saveEdit() {
  const title = document.getElementById('detailTitle').value.trim();
  const desc = document.getElementById('detailDesc').value;
  if (!title) return alert('Enter title');

  const res = await fetch(`${API_URL}/${currentIndex}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, description: desc })
  });

  if (res.ok) {
    alert('Task updated!');
  } else {
    alert('Failed to update task');
  }
}

function askDelete() {
  confirmBox.classList.add('show');
}

function closeConfirm() {
  confirmBox.classList.remove('show');
}

async function deleteCurrentTask() {
  const res = await fetch(`${API_URL}/${currentIndex}`, {
    method: 'DELETE'
  });

  if (res.ok) {
    currentIndex = null;
    closeConfirm();
    showList();
  } else {
    alert('Failed to delete task');
  }
}

async function showDeleteScreen() {
  hideAll();
  deleteScreen.classList.remove('hidden');

  try {
    const tasks = await fetchTasks();
    const deleteList = document.getElementById('deleteList');
    if (tasks.length === 0) {
      deleteList.innerHTML = '<p>No tasks to delete</p>';
      return;
    }
    deleteList.innerHTML = tasks.map(t =>
      `<div class="checkbox"><input type="checkbox" value="${t.id}"><div><strong>${t.title}</strong><br><small>${t.description || ''}</small></div></div>`
    ).join('');
  } catch {
    alert('Failed to load tasks for deletion');
  }
}

async function confirmDelete() {
  const ids = [...document.querySelectorAll('#deleteList input:checked')].map(i => +i.value);
  if (ids.length === 0) {
    alert('Select tasks to delete');
    return;
  }

  const promises = ids.map(id =>
    fetch(`${API_URL}/${id}`, { method: 'DELETE' })
  );

  try {
    await Promise.all(promises);
    showList();
  } catch {
    alert('Failed to delete selected tasks');
  }
}

goHome();
</script>
</body>
</html>
